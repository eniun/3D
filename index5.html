<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>V02</title>
    <script src="https://eniun.github.io/3D/dist/aframe-master.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.0/dist/aframe-environment-component.min.js"></script>
    <script>
      // Component to change to a sequential color on click.
     AFRAME.registerComponent('cursor-listener', {
     init: function () {
     var lastIndex = -1;
     var COLORS = ['red', 'green', 'blue'];
     this.el.addEventListener('click', function (evt) {
     lastIndex = (lastIndex + 1) % COLORS.length;
     this.setAttribute('material', 'color', COLORS[lastIndex]);
     console.log('I was clicked at: ', evt.detail.intersection.point);
     });
     }
     });
     function objectToPos(posObject){
     return posObject.x + " " + "1.6" + " " + posObject.z
     console.log("Prueba4")
     }
     function clickHandler(target){
     console.log("Prueba3")
     let cameraRig = document.querySelector('#camera-rig')
     let targetPos = objectToPos( target.getAttribute('position'))
     let camPos = objectToPos( cameraRig.getAttribute('position'))
     cameraRig.setAttribute('animation', `property: position; from: ${camPos}; to: ${targetPos}; dur: 700`)
     }
     function registerHandlerForClick(target){
     console.log("Prueba2")
     target.addEventListener('click', function(){ clickHandler(target)
     })
     }
     function setupHandlers(){
     console.log("Prueba")
     document.querySelector('a-scene').addEventListener('enter-vr', function () {
       let targetList = document.querySelectorAll('.moveTarget')
       let index=0
       console.log(targetList.length)
       while( index < targetList.length){
       registerHandlerForClick(targetList[index])
       index = index + 1
       }
     });
     }
     window.addEventListener("load",setupHandlers);
    </script>
  </head>
  <body>
   <a-scene
    background="color: #ffffff"
    environment
    cursor="rayOrigin: mouse; fuse: true" raycaster="objects: .raycastable">

    <a-entity id="camera-rig" kinematic-body="radius:0.5" movement-controls position="0 0 0">
    <a-entity camera position="0 1.6 0" wasd-controls="acceleration:100" look-controls="pointerLockEnabled: true">      
 
    </a-entity>  
      <a-entity id="leftHand" laser-controls="hand: left" raycaster="objects: .raycastable"></a-entity>
      <a-entity id="rightHand" laser-controls="hand: right" raycaster="objects: .raycastable" line="color: #118A7E"></a-entity>
    </a-entity>
 
    <a-obj-model class="moveTarget clickable raycastable" position="0 0 -4"       
     src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"> 
    </a-obj-model>

    <!--MOVIMIENTO OBJETO--> 
    <a-obj-model class="moveTarget clickable raycastable" position="0 0 0" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="-1.46364 0 0" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="-3.69367 0 0" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="-5.99347 0 0" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="2.59817 0 0" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="4.94539 0 0" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="6.32658 0 0" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="0.612965 0 -5.50148" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="2.21138 0 -5.50148" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="4.70904 0 -5.50148" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="-1.20529 0 -5.50148" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="-2.77285 0 -5.50148" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="-5.06129 0 -5.50148" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="-6.00595 0 -2.99807" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
    <a-obj-model class="moveTarget clickable raycastable" position="6.00595 0 -2.99807" src="assets/obj/posicion00.obj" material="src: assets/img/suelo_1.a.jpg; metalness: 0; shader: flat"></a-obj-model>
  
    </a-scene>
  </body>
</html>
